<html lang="ru"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>–£—á–µ–±–Ω–∞—è –≠–í–ú ‚Äî –º–∞–∫–µ—Ç (v2.0)</title>
    <style>
        :root{
            --red:#e31b23;
            --light:#f7f7f7;
            --muted:#9aa0a6;
            --accent:#f28c2b;
            --shadow: 0 3px 10px rgba(0,0,0,0.12);
            font-family: Tahoma, Arial, Helvetica, sans-serif;

            --bg-main:#f5f7fa;
            --bg-panel:#ffffff;
            --bg-soft:#f1f3f6;

            --text-main:#1f2937;
            --text-muted:#6b7280;

            --accent-blue:#2563eb;
            --accent-green:#059669;
            --accent-red:#dc2626;
            --accent-amber:#f59e0b;
        }
        html,body{height:100%;margin:0;background: #eeeeee;}
        .header{
            height: 63px;
            background: var(--red);
            color: #fff;
            display: flex;
            align-items: center;
            padding: 0 18px;
            box-sizing: border-box;
            box-shadow: var(--shadow);
        }
        .logo{font-size:20px;font-weight:700;}
        .subtitle{font-size:12px;opacity:0.95;margin-left:10px}
        .header-right{margin-left:auto;display:flex;gap:14px;align-items:center}
        .controls{display:flex;gap:8px;align-items:center}
        .ctrl-btn{width:36px;height:36px;border-radius:6px;background:#0f9d58;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;box-shadow:inset 0 -2px rgba(0,0,0,0.15)}
        .ctrl-btn.stop{background:#ff6b6b}
        .ctrl-btn.step{background:#3b82f6}

        .header-center{
            justify-self:center;
            display:flex;
            gap:10px;
        }

        .cpu-btn{
            padding:8px 16px;
            border-radius:8px;
            border:none;
            font-weight:700;
            color:#fff;
            cursor:pointer;
            box-shadow:var(--shadow);
        }
        .cpu-btn.step{background:var(--accent-blue)}
        .cpu-btn.run{background:var(--accent-green)}
        .cpu-btn.stop{background: #ff5959;}

        /* layout */
        .wrap{display:flex;height:calc(100% - 64px);}
        .col{padding: 7px;
            box-sizing: border-box;
            overflow: auto;}
        .left{width: 28%;border-right: 1px solid #e6e6e6;}
        .center{display: flex;
            justify-content: center;
            align-items: flex-start;}
        .right{flex:1;padding:18px}

        /* left memory */
        .mem-title{font-weight:700;margin-bottom:8px;color:#333}
        .mem-wrapper{height:90%;overflow:auto;border:1px solid #e9e9e9;--padding:8px;background:#fff}
        table.mem-table{width:100%;border-collapse:collapse;font-size:13px}
        table.mem-table th{background:#fafafa;color:#555;padding:8px;border-bottom:1px solid #eee;position:sticky;top:0}
        table.mem-table td{padding:6px 8px;border-bottom:1px solid #f3f3f3;font-family:monospace}
        table.mem-table tr:hover td{background:#fff7ed;cursor:pointer}

        .mem-toolbar{
            display: flex;
            gap: 8px;
            align-items: center;
            padding: 6px;
            margin-bottom: 6px;
            background: #ffffff;
            border-radius: 8px;
            font-size: 13px;
        }

        .mem-toolbar input{
            width: 65px;
            font-family:monospace;
            padding:4px;
        }

        .mem-toolbar button{
            padding:4px 8px;
            border-radius:6px;
            border:1px solid var(--border);
            background:#fff;
            cursor:pointer;
        }

        .code-toolbar{
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 8px;
        }

        .code-toolbar input{
            width:80px;
            font-family:monospace;
        }

        /* center machine */
        .machine{width: 760px;
            max-width: 100%;
            padding: 10px;}
        .panel{padding:10px;border-radius:6px;margin-bottom:12px}
        .regs-grid{display: grid;
            grid-template-columns: repeat(1, 1fr);
            gap: 0px;
            justify-content: start;
            justify-items: start;}
        .reg-group{border: 1px solid;
            --flex: 1;
            text-align: center;
            border-radius: 5px;
            padding-bottom: 6px;
            background: #fff;
            padding-top: 11px;}
        .reg-group-name{font-weight: 700;
            color: #000;
            padding: 6px;
            font-size: 18px;
            transform: translateY(-28px);
            margin-left: 35px;
            /* transform: translateX(58%); */
            position: absolute;}
        .reg{display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4px 10px;
            border-radius: 4px;
            --border: 1px dashed #eee;
            --background: #fbfbfb;}
        .reg .name{font-weight: 700;
            color: #000;
            padding-right: 6px;
            font-family: Courier;
            font-size: 14px;}
        .reg .val{font-family: monospace;
            background: #fff;
            padding: 5px 1px;
            border-radius: 4px;
            border: 1px solid #e6e6e6;
            min-width: 65px;
            text-align: center;}

        .big-row{--display:flex;gap:12px}
        .alu{flex:1}
        .regs{    /* width: 320px; */}
        .small{font-size:13px;color:#666}

        /* decoder */
        .decoder-row{display:flex;gap:8px;align-items:center;margin-top:8px}
        .dec-field{text-align: center;}
        .dec-field-name{color: #444;font-weight: 700;font-size: 14px;padding-bottom: 7px;border: 1px solid #e0e0e0;padding-top: 7px;border-radius: 6px;background: #f7f7f8;margin-bottom: 8px;}
        .dec-field-value{background: #f7f7f8;padding: 8px;border: 1px solid #e0e0e0;border-radius: 6px;/* min-width: 90px; */height: 17px;width: 17px;text-align: center;font-family: monospace;}

        /* right editor */
        .toolbar{display:flex;gap:12px;align-items:center;margin-bottom:8px}
        .icon{width:30px;height:30px;border-radius:6px;border:1px solid #ddd;display:flex;align-items:center;justify-content:center;background:#fff}
        .editor{height:330px;border:1px solid #dcdcdc;background:#fff;padding:8px;overflow:auto;font-family:monospace}
        .messages{height: 120px;
            border: 1px solid #dcdcdc;
            background: #fff;
            margin-top: 12px;
            padding: 8px;
            overflow: auto;
            font-family: monospace;
            border-radius: 10px;}
        .filename{font-weight:700;color:#444;margin-bottom:8px}

        /* bottom info */
        .bottom-info{position:fixed;left:50%;transform:translateX(-50%);bottom:0px;background:var(--red);color:#fff;padding-left: 14px;padding-right: 14px;padding-top: 6px;border-radius: 6px 6px 0px 0px;display:flex;gap:12px;align-items:center;font-size: 14px;}
        .badge{background:#fff;color:#333;padding:4px 8px;border-radius: 5px 5px 0px 0px;font-weight:700}

        @media (max-width:1000px){
            .left{display:none}
            .center{width:60%}
            .right{flex: 1;
                padding: 18px;}
        }
    </style>
</head>
<body>
<div class="header">
    <div style="display:flex;align-items:center">
        <div class="logo">–£—á–µ–±–Ω–∞—è –≠–í–ú</div>
        <div class="subtitle"></div>
    </div>

    <div class="header-center">
        <button class="cpu-btn step">‚è≠ –®–∞–≥</button>
        <button class="cpu-btn run">‚ñ∂ –ü—É—Å–∫</button>
        <button class="cpu-btn stop" style="
    /* color: #000; */
">‚ñ† –°—Ç–æ–ø</button>
    </div>

    <div class="header-right" ,="" style="display: none;">
        <div class="controls">
            <div class="ctrl-btn" id="runBtn" title="Run">‚ñ∂</div>
            <div class="ctrl-btn stop" id="stopBtn" title="Stop">‚ñ†</div>
            <div class="ctrl-btn step" id="stepBtn" title="Step">‚ñÆ</div>
        </div>
        <div style="font-size:12px;color:#fff;margin-left:8px">16-bit registers ¬∑ address bus 10-bit ¬∑ data bus 16-bit</div>
    </div>
</div>

<div class="wrap">
    <!-- LEFT: memory (words, 2 bytes) -->
    <div class="col left">

        <div class="mem-toolbar">
            <label style="
    text-align: center;
    width: 65px;
"><input type="checkbox"><div>Follow PC</div></label>
            <label style="
    text-align: center;
"><input type="checkbox"><div>BreackPoints</div></label><button>üßπ BP</button><button>‚§µ PC</button>
            <button>‚á£ SP</button>
            <input placeholder="0x020" style="
    font-family: courier;
    text-align: right;
">
            <button style="
    height: 42px;
">Go</button>

        </div>

        <div class="toolbar" ,="" style="display: none;">
            <div class="filename">–ü—Ä–æ–≥—Ä–∞–º–º–∞ –≤ –ø–∞–º—è—Ç–∏</div>
            <div style="flex:1"></div>
            <div class="icon" id="btnNew" title="New">üìÑ</div>
            <div class="icon" id="btnOpen" title="Open">üìÇ</div>
            <div class="icon" id="btnSave" title="Save">üíæ</div>
        </div>

        <div class="mem-wrapper" style="
    border-radius: 10px;
">
            <table class="mem-table" id="memTable" aria-label="memory table" style="text-align: center;border-radius: 10px;">
                <thead>
                <tr><th>–ê–¥—Ä–µ—Å</th><th>–ö–æ–º–∞–Ω–¥–∞</th><th>–ö–æ–¥</th></tr>
                </thead>
                <tbody id="memBody"><tr data-word-index="0"><td>0x000</td><td>NOP</td><td>0x1105</td></tr><tr data-word-index="1"><td>0x002</td><td>NOP</td><td>0x4800</td></tr><tr data-word-index="2"><td>0x004</td><td>NOP</td><td>0x8440</td></tr><tr data-word-index="3"><td>0x006</td><td>NOP</td><td>0x1234</td></tr><tr data-word-index="4"><td>0x008</td><td>NOP</td><td>0x0404</td></tr><tr data-word-index="5"><td>0x00A</td><td>NOP</td><td>0x0505</td></tr><tr data-word-index="6"><td>0x00C</td><td>NOP</td><td>0x0606</td></tr><tr data-word-index="7"><td>0x00E</td><td>NOP</td><td>0x0707</td></tr><tr data-word-index="8"><td>0x010</td><td>NOP</td><td>0x0808</td></tr><tr data-word-index="9"><td>0x012</td><td>NOP</td><td>0x0909</td></tr><tr data-word-index="10"><td>0x014</td><td>NOP</td><td>0x0A0A</td></tr><tr data-word-index="11"><td>0x016</td><td>NOP</td><td>0x0B0B</td></tr><tr data-word-index="12"><td>0x018</td><td>NOP</td><td>0x0C0C</td></tr><tr data-word-index="13"><td>0x01A</td><td>NOP</td><td>0x0D0D</td></tr><tr data-word-index="14"><td>0x01C</td><td>NOP</td><td>0x0E0E</td></tr><tr data-word-index="15"><td>0x01E</td><td>NOP</td><td>0x0F0F</td></tr><tr data-word-index="16"><td>0x020</td><td>NOP</td><td>0x1010</td></tr><tr data-word-index="17"><td>0x022</td><td>NOP</td><td>0x1111</td></tr><tr data-word-index="18"><td>0x024</td><td>NOP</td><td>0x1212</td></tr><tr data-word-index="19"><td>0x026</td><td>NOP</td><td>0x1313</td></tr><tr data-word-index="20"><td>0x028</td><td>NOP</td><td>0x1414</td></tr><tr data-word-index="21"><td>0x02A</td><td>NOP</td><td>0x1515</td></tr><tr data-word-index="22"><td>0x02C</td><td>NOP</td><td>0x1616</td></tr><tr data-word-index="23"><td>0x02E</td><td>NOP</td><td>0x1717</td></tr><tr data-word-index="24"><td>0x030</td><td>NOP</td><td>0x1818</td></tr><tr data-word-index="25"><td>0x032</td><td>NOP</td><td>0x1919</td></tr><tr data-word-index="26"><td>0x034</td><td>NOP</td><td>0x1A1A</td></tr><tr data-word-index="27"><td>0x036</td><td>NOP</td><td>0x1B1B</td></tr><tr data-word-index="28"><td>0x038</td><td>NOP</td><td>0x1C1C</td></tr><tr data-word-index="29"><td>0x03A</td><td>NOP</td><td>0x1D1D</td></tr><tr data-word-index="30"><td>0x03C</td><td>NOP</td><td>0x1E1E</td></tr><tr data-word-index="31"><td>0x03E</td><td>NOP</td><td>0x1F1F</td></tr><tr data-word-index="32"><td>0x040</td><td>NOP</td><td>0x2020</td></tr><tr data-word-index="33"><td>0x042</td><td>NOP</td><td>0x2121</td></tr><tr data-word-index="34"><td>0x044</td><td>NOP</td><td>0x2222</td></tr><tr data-word-index="35"><td>0x046</td><td>NOP</td><td>0x2323</td></tr><tr data-word-index="36"><td>0x048</td><td>NOP</td><td>0x2424</td></tr><tr data-word-index="37"><td>0x04A</td><td>NOP</td><td>0x2525</td></tr><tr data-word-index="38"><td>0x04C</td><td>NOP</td><td>0x2626</td></tr><tr data-word-index="39"><td>0x04E</td><td>NOP</td><td>0x2727</td></tr><tr data-word-index="40"><td>0x050</td><td>NOP</td><td>0x2828</td></tr><tr data-word-index="41"><td>0x052</td><td>NOP</td><td>0x2929</td></tr><tr data-word-index="42"><td>0x054</td><td>NOP</td><td>0x2A2A</td></tr><tr data-word-index="43"><td>0x056</td><td>NOP</td><td>0x2B2B</td></tr><tr data-word-index="44"><td>0x058</td><td>NOP</td><td>0x2C2C</td></tr><tr data-word-index="45"><td>0x05A</td><td>NOP</td><td>0x2D2D</td></tr><tr data-word-index="46"><td>0x05C</td><td>NOP</td><td>0x2E2E</td></tr><tr data-word-index="47"><td>0x05E</td><td>NOP</td><td>0x2F2F</td></tr><tr data-word-index="48"><td>0x060</td><td>NOP</td><td>0x3030</td></tr><tr data-word-index="49"><td>0x062</td><td>NOP</td><td>0x3131</td></tr><tr data-word-index="50"><td>0x064</td><td>NOP</td><td>0x3232</td></tr><tr data-word-index="51"><td>0x066</td><td>NOP</td><td>0x3333</td></tr><tr data-word-index="52"><td>0x068</td><td>NOP</td><td>0x3434</td></tr><tr data-word-index="53"><td>0x06A</td><td>NOP</td><td>0x3535</td></tr><tr data-word-index="54"><td>0x06C</td><td>NOP</td><td>0x3636</td></tr><tr data-word-index="55"><td>0x06E</td><td>NOP</td><td>0x3737</td></tr><tr data-word-index="56"><td>0x070</td><td>NOP</td><td>0x3838</td></tr><tr data-word-index="57"><td>0x072</td><td>NOP</td><td>0x3939</td></tr><tr data-word-index="58"><td>0x074</td><td>NOP</td><td>0x3A3A</td></tr><tr data-word-index="59"><td>0x076</td><td>NOP</td><td>0x3B3B</td></tr><tr data-word-index="60"><td>0x078</td><td>NOP</td><td>0x3C3C</td></tr><tr data-word-index="61"><td>0x07A</td><td>NOP</td><td>0x3D3D</td></tr><tr data-word-index="62"><td>0x07C</td><td>NOP</td><td>0x3E3E</td></tr><tr data-word-index="63"><td>0x07E</td><td>NOP</td><td>0x3F3F</td></tr></tbody>
            </table>
        </div>
    </div>

    <!-- CENTER: machine -->
    <div style="width: 39%;" class="col center">
        <div class="machine" style="
    text-align: center;
">
            <!-- ALU / registers -->
            <div style="
    margin-top: 10px;
    display: grid;
    flex-direction: column;
    align-content: center;
    align-items: baseline;
    justify-items: center;
    justify-content: center;
"><div class="panel big-row" style="
    /* display: grid; */
    /* align-content: space-around; */
    /* justify-items: center; */
    /* align-items: center; */
    padding: 0;
    justify-content: space-around;
    background: none;
">
                <div class="alu">
                    <div style="display:flex;justify-content: space-between;align-items:flex-end;">

                        <div class="small" ,="" style="display: none;">–í—Å–µ —Ä–µ–≥–∏—Å—Ç—Ä—ã 16-bit ‚Äî –æ—Ç–æ–±—Ä–∞–∂–µ–Ω—ã –≤ HEX (4 —Ü–∏—Ñ—Ä—ã)</div>
                    </div>

                    <div style="height:12px"></div>

                    <div style="
    display: flex;
    gap: 15px;
    justify-content: space-between;
"><div style="text-align: left;display:flex;display: grid;gap: 15px;justify-content: space-evenly;align-items: flex-start;justify-items: start;">
                        <div style="
    display: flex;
    gap: 15px;
"><div class="reg-group">
                            <div class="reg-group-name">–ê–õ–£</div>
                            <div class="reg"><div class="name">ACC</div><div class="val" id="ACC">0x0000</div></div>
                            <div class="reg"><div class="name">DR</div><div class="val" id="DR">0x0000</div></div>
                        </div><div class="reg-group">
                            <div class="reg-group-name">IO</div>
                            <div class="reg"><div class="name">IR</div><div class="val" id="IR">0x0000</div></div>
                            <div class="reg"><div class="name">OR</div><div class="val" id="OR">0x0000</div></div>
                        </div></div>

                        <div class="reg-group" style="
    width: 100%;
">
                            <div class="reg-group-name" style="
    margin-left: 100px;
">–û–ó–£</div>
                            <div class="reg"><div class="name">MAR</div><div class="val" id="MAR">0x0000</div><div class="name" style="
    margin-left: 7px;
">MDR</div><div class="val" id="MDR">0x0000</div></div>

                        </div>




                        <div class="panel" style="text-align: left;padding:8px;/* display: inline-block; */">
                            <div style="display:flex;/* display: inline-block; */justify-content:space-between;align-items:center">
                                <div style="font-weight:700;margin-bottom: 7px;font-family: courier;font-size: 22px;">FLAGS</div>
                                <div class="small" ,="" style="display: none;">Z S C O I H</div>
                            </div>
                            <div style="display: none;margin-top:8px;display:flex;gap:8px;align-items:center;display: none;">
                                <div class="dec-field">
                                    <div class="dec-field-name">Z</div>
                                    <div class="dec-field-value" id="F_Z">0</div>
                                </div>
                                <div class="dec-field">
                                    <div class="dec-field-name">S</div>
                                    <div class="dec-field-value" id="F_S">0</div>
                                </div>
                                <div class="dec-field">
                                    <div class="dec-field-name">O</div>
                                    <div class="dec-field-value" id="F_O">0</div>
                                </div>
                                <div class="dec-field">
                                    <div class="dec-field-name">I</div>
                                    <div class="dec-field-value" id="F_I">0</div>
                                </div>
                                <div class="dec-field">
                                    <div class="dec-field-name">H</div>
                                    <div class="dec-field-value" id="F_H">0</div>
                                </div>
                            </div><table class="mem-table" aria-label="memory table" style="width: 191px;height: 66px;color: #000;background: #fff;text-align: center;/* border-radius: 10px; *//* border-radius: 10px; *//* border: 1px solid; */border-radius: 10px;">
                            <thead style="
    width: 10px;
    color: #000;
    border-radius: 10px;
">
                            <tr style="
    border-radius: 10px;
">
                                <th style="
    color: #000;
">Z</th><th style="
    color: #000;
">S</th><th style="
    color: #000;
">O</th><th style="
    color: #000;
">I</th><th style="
    color: #000;
">H</th>
                            </tr>
                            </thead>
                            <tbody style="
    padding: 10px;
"><tr data-word-index="0" style="
    padding: 1px;
"><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>



                            </tbody></table>
                        </div></div><div class="reg-group" style="
    border: 0;
    background: none;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
">

                        <div class="reg"><div class="name">AR</div><div class="val" id="AR">0x0000</div></div>
                        <div class="reg"><div class="name">PC</div><div class="val" id="PC">0x0000</div></div>
                        <div class="reg"><div class="name">SP</div><div class="val" id="SP">03FE</div></div>
                        <div class="reg"><div class="name">BR</div><div class="val" id="BR">0x0000</div></div>
                    </div><div class="regs" style="
    /* border: 1px solid; */
    border-radius: 5px;
    background: #fff;
    padding-top: 10px;
">
                        <div class="reg-group-name" style="
    /* position: relative; */
    margin-left: 28px;
    /* transform: translateY(-18px); */
">–†–û–ù</div>

                        <div class="regs-grid" id="gRegs">
                            <div class="reg"><div class="name">R0</div><div class="val" id="R0">0x0000</div></div>
                            <div class="reg"><div class="name">R1</div><div class="val" id="R1">0x0000</div></div>
                            <div class="reg"><div class="name">R2</div><div class="val" id="R2">0x0000</div></div>
                            <div class="reg"><div class="name">R3</div><div class="val" id="R3">0x0000</div></div>
                            <div class="reg"><div class="name">R4</div><div class="val" id="R4">0x0000</div></div>
                            <div class="reg"><div class="name">R5</div><div class="val" id="R5">0x0000</div></div>
                            <div class="reg"><div class="name">R6</div><div class="val" id="R6">0x0000</div></div>
                            <div class="reg"><div class="name">R7</div><div class="val" id="R7">0x0000</div></div>
                        </div>









                    </div></div>
                </div>


            </div><div class="reg-group" style="
    width: 100%;
    /* display: inline-block; */
    background: #ffffff;
    border: 0;
">
                <div class="reg-group-name" style="
    margin-left: 170px;
">–ü–æ–ª—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏</div>
                <div style="
    display: flex;
    justify-content: space-between;
"><div class="reg">
                    <div class="name">INR</div><div class="val" id="INR">0x0000</div></div>
                    <div class="reg">	<div class="name">EXT</div><div class="val" id="EXT">0x0000</div>
                    </div></div>
                <div style="
    display: flex;
"><div class="reg">
                    <div class="name">OPC</div><div class="val" id="OPC" style="
    min-width: 44px;
">0x00</div></div><div class="reg">
                    <div class="name">ADT</div><div class="val" id="ADT" style="
    min-width: 35px;
">0x0</div></div><div class="reg">
                    <div class="name">EXF</div><div class="val" id="EXF" style="
    width: 10px;
    min-width: 22px;
">0</div></div><div class="reg">
                    <div class="name">ARG</div><div class="val" id="ARG" style="
    min-width: 44px;
">0x00</div>
                </div></div>




            </div></div>


        </div>
    </div>

    <!-- separator -->
    <div style="width: 2px;background:var(--red);/* background: #fff; */"></div>

    <!-- RIGHT: editor / controls -->
    <div class="col right">
        <div class="code-toolbar">
            <button style="
    padding: 6px 12px;
    border-radius: 6px;
    border: 0;
    background: #0f9d58;
    color: #fff;
">üíæ Save</button>
            <button style="
    padding: 6px 12px;
    border-radius: 6px;
    border: 0;
    background: #ff2e2e;
    color: #fff;
">üìÇ Load</button>
            <span>Load to:</span>
            <input value="0x000" style="
    font-family: courier;
    /* border-color: coral; */
    /* border: 1px solid coral; */
    text-align: right;
    padding: 2px 2px;
">
        </div>

        <div class="editor" id="source" contenteditable="true">–ù–∞–ø–∏—à–∏ –ø—Ä–æ–≥—Ä–∞–º–º—É –≤ –∞—Å—Å–µ–º–±–ª–µ—Ä–µ –¥–ª—è –≠–í–ú (–ø—Ä–∏–º–µ—Ä: NOP, MOV, ADD –∏ —Ç.–¥.)</div>

        <div style="margin-top:12px;display:flex;gap:8px;align-items:center;justify-content: flex-end;">
            <button id="loadExample" style="padding:8px 12px;border-radius:6px;border:0;background:#3b82f6;color:#fff;display: none;">–ó–∞–≥—Ä—É–∑–∏—Ç—å –æ–±—Ä–∞–∑–µ—Ü</button>
            <button id="assemble" style="padding:8px 12px;border-radius:6px;border:0;background:#0f9d58;color:#fff">–ê—Å—Å–µ–º–±–ª–∏—Ä–æ–≤–∞—Ç—å</button>
            <button id="clearMem" style="padding:8px 12px;border-radius:6px;border:0;background:#ff6b6b;color:#fff">–û—á–∏—Å—Ç–∏—Ç—å –û–ó–£</button>
        </div>

        <div style="margin-top:12px;font-weight:700;color:#333">–°–æ–æ–±—â–µ–Ω–∏—è:</div>
        <div class="messages" id="log">17:50:46 ‚Äî Sample memory initialized.
            –ì–æ—Ç–æ–≤–æ.</div>
    </div>
</div>

<div class="bottom-info">
    <div style="padding: 4px 8px;--padding-bottom: 8px;">CPU</div>
    <div class="badge">–û–ó–£</div>
    <div class="badge">–í–Ω–µ—à–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</div>
</div>

<script>
    /*
      –ë—ã—Å—Ç—Ä–∞—è front-end –∏–º–∏—Ç–∞—Ü–∏—è:
      - –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –ø–∞–º—è—Ç—å –ø–æ —Å–ª–æ–≤–∞–º (2 –±–∞–π—Ç–∞) ‚Äî –∞–¥—Ä–µ—Å–∞ 0x000,0x002,...,0x03E
      - –ø–æ–∑–≤–æ–ª—è–µ—Ç –∫–ª–∏–∫–∞—Ç—å —Å–ª–æ–≤–æ, –∑–∞–≥—Ä—É–∂–∞—Ç—å –µ–≥–æ –≤ IR –∏ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å
      - –¥–µ–∫–æ–¥–µ—Ä —Ä–∞–∑–±–∏—Ä–∞–µ—Ç –ø–æ–ª–µ –∫–∞–∫ –≤ PDF: [15:10] opcode(6), [9:7] addrmode(3), [6] ext, [5:0] operand(6)
      - –≤—Å–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ HEX (4 —Ü–∏—Ñ—Ä—ã –¥–ª—è 16-bit)
      - –ø—Ä–∏–º–∏—Ç–∏–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å —Ä–µ–≥–∏—Å—Ç—Ä–∞–º–∏ (—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–µ –≤ DOM)
    */

    const memBody = document.getElementById('memBody');
    const LOG = document.getElementById('log');
    const PC = document.getElementById('PC');
    const IRInput = document.getElementById('irInput');

    function hex4(n){ return ("000"+(n & 0xFFFF).toString(16).toUpperCase()).slice(-4); }
    function hex3(n){ return ("000"+(n & 0x3FF).toString(16).toUpperCase()).slice(-3); }
    function hex2(n){ return ("00"+(n & 0xFF).toString(16).toUpperCase()).slice(-2); }

    // –∏–Ω–∏—Ü–∏–∏—Ä—É–µ–º –ø–∞–º—è—Ç—å: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ–≤ (word = 2 bytes) = 0x400 / 2 = 0x200 = 512
    const WORDS = 0x200;
    let memory = new Uint16Array(WORDS); // –∫–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç ‚Äî —Å–ª–æ–≤–æ (16 bit)

    function initSampleMemory(){
        for(let i=0;i<WORDS;i++){
            const val = (i & 0xFF) | ((i<<8)&0xFF00);
            memory[i] = val;
        }
        // small program sample (NOP = 0x00) ‚Äî –ø–æ–º–µ—â–∞–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –∫–∞–∫ –ø—Ä–∏–º–µ—Ä—ã
        // –ø—Ä–∏–º–µ—Ä: ADD (opcode 0x04) with immediate #5 -> construct short instr:
        // opcode(6)=0x04 -> 000100, addrmode 010 (immediate), ext=0, operand=000101 (5)
        // build bits: (opcode<<10)|(addr<<7)|(ext<<6)|operand
        function mkShort(opcode, addr, ext, operand){
            return ((opcode & 0x3F)<<10) | ((addr & 0x7)<<7) | ((ext&1)<<6) | (operand & 0x3F);
        }
        memory[0] = mkShort(0x04, 0x2, 0, 5); // ADD #5
        memory[1] = mkShort(0x12, 0x0, 0, 0); // PUSH (opcode 0x12)
        memory[2] = mkShort(0x21, 0x0, 1, 0); // JMP with EXT=1 (just example)
        memory[3] = 0x1234; // extended word
        // stack pointer default (display only)
        document.getElementById('SP').textContent = hex4(0x03FE);
        renderMemory();
        log('Sample memory initialized.');
    }

    function renderMemory(){
        memBody.innerHTML = '';
        // show first 64 words for convenience (addresses 0x000 .. 0x07E)
        const show = 64;
        for(let i=0;i<show;i++){
            const addrByte = i*2; // byte address
            const addrWord = i;
            const tr = document.createElement('tr');
            const tdAddr = document.createElement('td');
            tdAddr.textContent = '0x' + hex3(addrByte);
            const tdVal = document.createElement('td');
            tdVal.textContent = '0x' + hex4(memory[addrWord]);
            const tdCom = document.createElement('td');
            tdCom.textContent = 'NOP';
            tr.appendChild(tdAddr); tr.appendChild(tdCom); tr.appendChild(tdVal);
            tr.dataset.wordIndex = addrWord;
            tr.addEventListener('click', (e)=>{
                const idx = Number(tr.dataset.wordIndex);
                loadIRFromMemory(idx);
            });
            memBody.appendChild(tr);
        }
    }

    function loadIRFromMemory(wordIndex){
        const val = memory[wordIndex];
        IRInput.value = hex4(val);
        document.getElementById('IR').textContent = hex4(val); // if IR element existed
        decodeIR(val);
        log('Loaded IR from memory @' + hex3(wordIndex*2) + ' -> ' + hex4(val));
        PC.textContent = hex4(wordIndex*2);
    }

    function decodeIRHexString(hexstr){
        const n = parseInt(hexstr,16);
        if (isNaN(n)) return null;
        return n & 0xFFFF;
    }

    function decodeIR(val){
        // val is 16-bit word
        const opcode = (val >> 10) & 0x3F;
        const addrmode = (val >> 7) & 0x7;
        const ext = (val >> 6) & 0x1;
        const operand = val & 0x3F;
        document.getElementById('dOP').textContent = 'OP: ' + ("00"+opcode.toString(16).toUpperCase()).slice(-2);
        document.getElementById('dAM').textContent = 'AM: ' + addrmode.toString(10);
        document.getElementById('dEX').textContent = 'EXT: ' + ext;
        document.getElementById('dOPR').textContent = 'OPER: ' + ("00"+operand.toString(16).toUpperCase()).slice(-2);

        // –∫—Ä–∞—Ç–∫–∞—è —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –ø–æ opcode (—á–∞—Å—Ç–∏—á–Ω–∞—è, –∏–ª–ª—é—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ)
        const opNames = {
            0x00:'NOP',0x01:'EI',0x02:'DI',0x03:'HLT',0x04:'ADD',0x05:'SUB',0x06:'CMP',
            0x07:'MUL',0x08:'DIV',0x09:'MOD',0x0A:'INC',0x0B:'DEC',0x10:'SWL',0x11:'SWR',
            0x12:'PUSH',0x13:'POP',0x16:'CALL',0x17:'RET',0x18:'INT',0x19:'IRET',0x1A:'IN',
            0x1B:'OUT',0x1C:'MOV',0x1D:'WR',0x1E:'RD',0x1F:'WRBR',0x20:'WRSP',0x21:'JMP',
            0x22:'JZ',0x23:'JNZ'
        };
        const name = opNames[opcode] || 'UNK';
        const addrmodes = {
            0:'Direct',1:'Reg',2:'Immediate',3:'MemIndirect',4:'BR+offset',5:'@Rx',6:'@Rx+',7:'-@Rx'
        };
        const amn = addrmodes[addrmode] || 'unk';
        let info = name + ' ('+amn+')';
        if(ext===1){
            info += ' ‚Äî —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è (—Ç—Ä–µ–±—É–µ—Ç –≤—Ç–æ—Ä–æ–≥–æ —Å–ª–æ–≤–∞)';
        } else {
            info += ' ‚Äî –∫–æ—Ä–æ—Ç–∫–∞—è';
        }
        document.getElementById('decodeInfo').textContent = info;
        return {opcode,addrmode,ext,operand,name};
    }

    document.getElementById('decodeBtn').addEventListener('click', ()=>{
        const val = decodeIRHexString(IRInput.value);
        if(val===null){ alert('–ù–µ–≤–µ—Ä–Ω—ã–π HEX –≤ –ø–æ–ª–µ IR'); return; }
        decodeIR(val);
        log('Decoded IR = ' + hex4(val));
    });

    // small helpers for log
    function log(msg){
        const t = new Date().toLocaleTimeString();
        LOG.textContent = t + ' ‚Äî ' + msg + '\n' + LOG.textContent;
    }

    // buttons
    document.getElementById('loadExample').addEventListener('click', ()=>{
        initSampleMemory();
    });
    document.getElementById('clearMem').addEventListener('click', ()=>{
        memory.fill(0);
        renderMemory();
        log('Memory cleared.');
    });

    // run/step (mock)
    document.getElementById('stepBtn').addEventListener('click', ()=>{
        // step: read PC, fetch word, decode, increment PC by 2 (or by 4 if EXT)
        const pcVal = decodeIRHexString(PC.textContent) || 0;
        const wordIndex = (pcVal/2)|0;
        if(wordIndex < 0 || wordIndex >= WORDS){ log('PC out of range'); return; }
        const ir = memory[wordIndex];
        const dec = decodeIR(ir);
        log('STEP: PC=' + hex3(pcVal) + ' IR=' + hex4(ir) + ' -> ' + (dec.name || 'UNK'));
        let inc = 2;
        if(dec.ext===1) inc = 4;
        const newPC = (pcVal + inc) & 0x3FF;
        PC.textContent = hex4(newPC);
    });

    document.getElementById('runBtn').addEventListener('click', ()=>{
        log('Run pressed ‚Äî –≤ –º–∞–∫–µ—Ç–µ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –Ω–∞—Å—Ç–æ—è—â–µ–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ.');
        alert('–ó–∞–ø—É—Å–∫ (mock): —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –≤ —ç—Ç–æ–π –¥–µ–º–æ-–≤–µ—Ä—Å–∏–∏ –Ω–µ—Ç.');
    });

    document.getElementById('btnSave').addEventListener('click', ()=>{
        const code = document.getElementById('source').innerText;
        const blob = new Blob([code], {type:'text/plain;charset=utf-8'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = 'program.asm';
        document.body.appendChild(a); a.click();
        a.remove();
        URL.revokeObjectURL(url);
        log('Source saved as program.asm');
    });

    // editable register click to edit value quickly
    document.querySelectorAll('.val').forEach(el=>{
        el.addEventListener('click', ()=>{
            const old = el.textContent;
            const v = prompt('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å (HEX 4)', old);
            if(v===null) return;
            const parsed = parseInt(v,16);
            if(isNaN(parsed)){ alert('–ù–µ–≤–µ—Ä–Ω—ã–π HEX'); return; }
            // special-case MAR (3 hex digits)
            if(el.id === 'MAR'){
                el.textContent = ("000"+(parsed & 0x3FF).toString(16).toUpperCase()).slice(-3);
            } else {
                el.textContent = hex4(parsed);
            }
            log('Register ' + (el.previousElementSibling ? el.previousElementSibling.textContent : el.id) + ' set to ' + el.textContent);
        });
    });

    // init
    initSampleMemory();
</script>


</body></html>